<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add</title>
    <link rel="stylesheet" href="addstyle.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/08c13121c6.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="container">
        <h1 id="addh1">Add New Todo</h1>
        <p id="Goal">Goal</p>
        <textarea name="text" id="textbox" cols="50" rows="15" required placeholder="What do you want to do?"></textarea><br />
    
        <div class="priorityContainer">
            <label for="priority">Priority</label>
            <select id="priority" name="priority" required>
                <option value="" disabled selected>Select priority</option>
                <option value="high">High</option>
                <option value="middle">Middle</option>
                <option value="low">Low</option>
            </select><br />
        </div>
        <div class="deadlineContainer">
            <p id="deadlineP">Deadline (dd/mm/yyyy)</p>
            <input type="text" id="deadline" name="deadline" required placeholder="e.g. 20/04/2025"><br />
        </div>
        <div class="buttons">
            <button id='submitbutton' type="submit" class="allbutton">Submit</button>
            <a href="/"><button id="backbutton" class="allbutton" type="button">Back</button></a>
        </div>
    </div>
</body>
<script>
    
    isValidDate = (dateString) => {
        const dateList = dateString.split("/"); // Split the datestring in to an array of strings
        if (dateList.length !== 3) return false; // Check if the date string has exactly 3 parts

        // make 3 variables for the day, month and year
        const day = parseInt(dateList[0], 10);
        const month = parseInt(dateList[1], 10);
        const year = parseInt(dateList[2], 10); 

        const date = new Date(year, month - 1, day); // Month is 0-based in JavaScript date object (e.g, January is 0, February is 1, etc.)
        // Check if the date is valid by comparing the input values with the date object values
        return (date.getFullYear() === year && date.getMonth() === month - 1 && date.getDate() === day); 
    }

    const regex = /^([0]?[1-9]|[12][0-9]|[3][0-1])[/]([0]?[1-9]|[1][0-2])[/]([0-9]{4})$/;

    document.getElementById('submitbutton').addEventListener('click', function(event) {
        const textInput = document.getElementById("textbox").value.toString();
        const priorityInput = document.getElementById("priority").value.toString();
        const deadlineInput = document.getElementById("deadline").value.toString();

        if (textInput === "" || priorityInput === "" || deadlineInput === "") {
            window.alert('Please fill in all the fields'); // Show an alert if any field is empty
            return; // Stop the function execution
        }
        if (!regex.test(deadlineInput) || !isValidDate(deadlineInput)) {
            window.alert('Please enter a valid date in the format dd/mm/yyyy'); // Show an alert if the date is invalid
            return; // Stop the function execution
        }
        fetch ("/create-todo", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                text: document.getElementById("textbox").value,
                priority: document.getElementById("priority").value,
                deadline: document.getElementById("deadline").value
            })
        })
        .then(res => {
            if (res.ok) {
                window.alert("Todo Added Successfully!"); // Show a success message
                window.location.href = "/"; // Redirect to the home page
            } else {
                console.error("Failed To Add Your Todo :(", res.statusText); // Show an error message
            }
        })
    });
</script>>
</html>