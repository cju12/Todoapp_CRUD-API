<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo app</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="topUI">
            <a href="/"><h1>Todo App</h1></a>
            <form action ="/add" method="get">
                <button class="addTodo" id="add">Add</button>
            </form>
        </div>
    <% if (todoList.length > 0) { %>
        <% todoList.forEach(function(Todo) { %>
            <div class="todolist">
                <ul class="todo-list">
                    <li><strong><%= Todo.text %></strong></li>
                    <li><%= Todo.priority %></li>
                    <li><%= Todo.deadline %></li>
                </ul>
                <button class='delete' onclick="deleteFunc(event)">delete</button>
                <form action = "/patch<%= Todo._id %>" method="get">
                    <button class = "Edit">Edit</button>
                </form>
            </div>
        <% }) %>
    <% } else { %>
        <p>No todos available.</p>
    <% } %>
    </div>
</body>
<script>
    function deleteFunc(event) {
        if (confirm('Are you sure you want to delete this todo?')) event.preventDefault();
        else return;

        // Get the todo ID from the form action URL
        const todoId = event.target.parentElement.querySelector('form').action.split('/patch').pop();
        fetch(`/${todoId}`, {
            method: 'DELETE',
        })
        .then(res => {
            if (res.ok) {
                window.location.reload(); // Reload the page to see the updated list
            } else {
                console.error('Error deleting todo:', res.statusText);
            }
        })
    };
</script>
</html>
